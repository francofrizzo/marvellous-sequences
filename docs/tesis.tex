\documentclass[11pt]{article}
\usepackage[a4paper, margin=2.25cm, headsep=1em]{geometry}

\usepackage[spanish]{babel}
\spanishlcroman
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[letterspace=25]{microtype}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{bm}
\usepackage{cases}
\usepackage{xfrac}
\usepackage{framed}
\usepackage{fancyhdr}

\usepackage{enumitem}
\setlist[enumerate,1]{label=(\alph*)}
\setlist[enumerate,2]{label=\roman*.}
\usepackage{float}
\usepackage[center]{caption}
\usepackage{cite}
\usepackage{diagbox}

\usepackage[table]{xcolor}
\definecolor{ne-proof}{HTML}{ea5c69}
\definecolor{ne-empir}{HTML}{ffac81}
\definecolor{ne-conjc}{HTML}{fdf2ac}
\definecolor{e-count-for}{HTML}{58d383}
\definecolor{e-count-emp}{HTML}{71d7e9}
\definecolor{e-examples}{HTML}{d9edfa}

\usepackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{babel}
\usepackage{pgfplots}
\pgfplotsset{compat=1.9}

\newcommand\myauthor{Franco Frizzo}
\newcommand\mytitle{Tesis de licenciatura}
\newcommand\mydate{\today}

\usepackage[pdfauthor={\myauthor},
	    pdftitle={\mytitle},
	    hidelinks]{hyperref}

\setlength{\parskip}{.5em}
\renewcommand{\baselinestretch}{1.05}
\setlength{\headsep}{1.7em}
\setlist[enumerate]{itemsep=.1em, topsep=0em}
\setlist[itemize]{itemsep=.1em, topsep=0em}

\pagestyle{fancy}
\rhead{\MakeUppercase{\footnotesize{\textls{\myauthor}}}}
\lhead{\MakeUppercase{\footnotesize{\textls{\mytitle}}}}

\include{commands}

\begin{document}

\title{\mytitle}
\author{\myauthor}
\date{\mydate}

\maketitle
\tableofcontents

\newpage

\section{Introducción}

Una secuencia $s$ de símbolos de $\{0,1\}$  es {\em maravillosa} de orden $(n,m)$
si todas las secuencias 
 de longitud $n$ ocurren exactamente  $n$ veces en
 la palabra circular definida por $s$.
Una  secuencia es {\em maravillosa anidada} de orden $(n,m)$
si es maravillosa  de orden $(n,m)$
y, cuando  $n>1$, es la concatenación  dos secuencias
 maravillosas  anidadas de orden $(n-1,m)$.

Se sabe que para todo $(n,m)$
 existen las secuencias maravillosas anidadas que cumplen que 
todas las secuencias de longitud $m$ ocurren en distintas posiciones módulo $m$.
¿Es necesaria esta condición de ocurrencia en posiciones 
que son distintas módulo $m$?
Es decir, ¿Existen las secuencias maravillosas anidadas de orden $(n,m)$ 
sin la restricción de que las ocurrencias
sean en distintas posiciones módulo $m$?

\subsection{Antecedentes}

Consideremos un alfabeto finito. Los collares --o palabras circulares-- de
De Bruijn de orden $n$ son aquellas en las que todas las palabras de longitud
$n$ aparecen exactamente una vez.
Las secuencias de De Bruijn de orden $n$ tienen longitud $b^n$, siendo $b$ la
cantidad de símbolos del alfabeto.
Nicolaas~Govert de~Bruijn \cite{de-bruijn-combinatorial-problem} dio esta definición al mismo tiempo que las caracterizó como circuitos eulerianos
en los llamados grafos de De Bruijn, y contó cuántas hay.

Recientemente Alvarez, Becher, Ferrari y Yuhjtman \cite{alvarez-perfect-necklaces}
presentaron una generalización de los collares de De Bruijn,
que se llaman \emph{collares perfectos}.
Una collar es \emph{perfecto} de orden $(n,m)$ si todas las secuencias 
de longitud $n$ ocurren exactamente $m$ veces, y todas ellas en distintas
posiciones módulo~$m$.
Las secuencias perfectas de orden $(n,m)$ tienen longitud  $mb^n$.
En \cite{alvarez-perfect-necklaces} las secuencias perfectas están
caracterizadas como circuitos eulerianos en los llamados grafos astutos,
dándose una fórmula para la cantidad de secuencias perfectas de orden $(n,m)$.

Becher y Carton \cite{becher-nested-perfect} definieron las
\emph{secuencias perfectas anidadas}; las mismas son palabras lineales --no
circulares-- que, miradas circularmente, son perfectas de orden $(n,m)$ y,
además, cuando $n>1$, son la concatenación de dos secuencias perfectas anidadas
de orden $(n-1, m)$.
En \cite{becher-nested-perfect} las secuencias perfectas anidadas son
caracterizadas como el resultado de una transformación lineal que puede
obtenerse a partir del triángulo de Pascal. Este trabajo también cuenta la
cantidad de secuencias perfectas anidadas $(n,m)$ siempre que $m$ es potencia
de $2$.

Becher y Carton definieron las \emph{secuencias maravillosas anidadas}
de orden $(n,m)$ soltando la restricción de que las $m$ 
ocurrencias debían ocurrir  en 
posiciones distintas módulo $m$, y dejaron abierta la pregunta de si existen o no las 
{\em secuencias maravillosas anidadas} que no son {\em perfectas anidadas}.


\subsection{Objetivo y resultados}
En este trabajo, nos propusimos responder la pregunta formulada por Becher y
Carton de si existen secuencias maravillosas anidadas que no son perfectas
anidadas.
En caso de responder positivamente, nos propusimos dar métodos de construcción
que permitieran obtener secuencias de estas características, con el objetivo
de máxima de contar la cantidad de secuencias maravillosas anidadas de orden
$(n,m)$ y, en caso de que esto no fuera posible, de poder brindar ejemplos que
garantizaran su existencia.



\subsection{Estructura del documento}

El resto de este documento está estructurado de la siguiente manera. El
Capítulo \ref{asd} hace un 

\newpage

\section{Preliminares}
\label{asd}

Para comenzar, presentamos algunas definiciones sobre secuencias que son
esenciales para comprender este trabajo, como así también algunos detalles
de la notación que utilizamos a lo largo del mismo.

Sea $\alphabet$ un alfabeto fijo de $b$ símbolos, con $b \geq 2$. En los
ejemplos que brindamos a lo largo de este trabajo consideramos el alfabeto
$\alphabet = \lbrace 0, 1 \rbrace$, a menos que se indique lo contrario.
Llamamos \emph{palabra} o \emph{cadena} a una secuencia finita de caracteres
tomados de este alfabeto.
Para referirnos a las posiciones que ocupan los caracteres dentro de una
palabra, las numeramos comenzando en $1$.

Definimos la función de rotación $\sigma: \alphabet^* \to \alphabet^*$ como
una transformación biyectiva que quita el último carácter de una palabra y lo
coloca al principio. Es decir,
\[ \sigma(\alpha_1\dots\alpha_{n-1}\alpha_n) =
	\alpha_n\alpha_1\dots\alpha_{n-1}. \]

La aplicación sucesiva de la función de rotación divide a las palabras en clases
de equivalencia, que llamamos \emph{collares}. Un collar es, entonces, el
conjunto de todas las rotaciones posibles de una palabra, y lo notamos usando
corchetes:
\[ \neck{w} = \lbrace \sigma^{n}(w) : n \in \nats_0 \rbrace. \]
Por ejemplo,
\[ \neck{11100} = \lbrace 11100, 01110, 00111, 10011, 11001 \rbrace; \]
\[ \neck{00000} = \lbrace 00000 \rbrace. \]
Un collar puede pensarse como una ``palabra circular'', donde no importa
cuál de los caracteres es el primero. A cada una de las palabras que forman
parte de un collar la llamamos un \emph{corte} del mismo.

El \emph{período} de una palabra $w$ es el menor $n > 0$ tal que
$\sigma^n(w) = w$. Por ejemplo, la cadena $11001100$ tiene período $4$,
mientras que $11001101$ tiene período $8$.
Notar que el período de una cadena necesariamente divide a su longitud.
Además, es igual a la cantidad de cortes distintos que posee el collar al que
pertenece la palabra.

Una \emph{subcadena} es una secuencia de caracteres consecutivos dentro de una
palabra. Usamos la notación $w\substr{i}{j}$ para hacer referencia a la
subcadena de $w$ que comprende las posiciones que van desde $i$ hasta $j$,
inclusive. En ocasiones, decimos que una palabra \emph{aparece} en otra palabra
para referirnos a que es una subcadena. Por ejemplo, $101$ y $1001$ aparecen en
(o son subcadenas de) la palabra $01010011$. Decimos que una palabra
\emph{aparece circularmente} en otra si aparece en alguna palabra del collar
correspondiente. Por ejemplo, $110$ no aparece en la palabra anterior, pero sí
aparece circularmente. En este caso, también podemos decir directamente que
la palabra \emph{aparece} en el collar.

\subsection{Collares y secuencias de De Bruijn}

En \cite{de-bruijn-combinatorial-problem}, Nicolaas G. de Bruijn realizó un detallado estudio de una clase
de collares que han pasado a ser conocidos con su nombre.

\begin{definition}[Collar de De Bruijn]
	Un \emph{collar de De Bruijn} de orden $n$ (o $n$-de De Bruijn) es un collar
	de longitud $b^n$ en el que cada una de las posibles palabras de longitud $n$ 
	aparece exactamente una vez.
\end{definition}

\begin{examples}\ \\
	\begin{itemize}
		\item El collar $\neck{11000101}$ es un collar de De Bruijn de orden $3$.
		\item El collar $\neck{0101100111101000}$ es un collar de De Bruijn de orden $4$.
	\end{itemize}
\end{examples}

De Bruijn presenta una bonita caracterización de estos collares como circuitos
en una familia de digrafos que ha dado en conocerse como digrafos de De Bruijn.
El digrafo de De Bruijn de orden $n$ tiene como vértices todas las posibles
palabras de longitud $n$; existe una arista entre dos palabras si los últimos
$n-1$ caracteres de la primera coinciden con los primeros $n-1$ caracteres de la
segunda. Utilizamos la notación $G_n$ para referirnos al digrafo de De Bruijn
de orden $n$.

\begin{figure}[h] \centering
	\begin{tabular}{ccc}
		\begin{tabular}{c}
			\begin{tikzpicture}[->,>=stealth,auto,node distance=2cm,
				every loop/.style={},thick,main node/.style={circle,draw}]
			
			\node[main node] (0) {0};
			\node[main node] (1) [below of=0] {1};
			
			\draw[every node/.style={font=\scriptsize}]
			(0) edge [bend left] node {01} (1)
					edge [loop above] node {00} (0)
			(1) edge [bend left] node {10} (0)
					edge [loop below] node {11} (1);
			\end{tikzpicture}
		\end{tabular} &

		\begin{tabular}{c}
			\begin{tikzpicture}[->,>=stealth,auto,node distance=2.2cm,
				every loop/.style={},thick,main node/.style={circle,draw,font=\small}]
			
			\node[main node] (00) {00};
			\node[main node] (01) [below right of=00] {01};
			\node[main node] (10) [below left of=00] {10};
			\node[main node] (11) [below right of=10] {11};
			
			\draw[every node/.style={font=\scriptsize}]
			(00) edge [loop above] node {000} (00)
					edge [bend left] node {001} (01)
			(01) edge [bend left] node {011} (11)
					edge [bend left] node {010} (10)
			(10) edge [bend left] node {100} (00)
					edge [bend left] node {101} (01)
			(11) edge [bend left] node {110} (10)
					edge [loop below] node {111} (11);
			\end{tikzpicture}
		\end{tabular} &

		\begin{tabular}{c}
			\begin{tikzpicture}[->,>=stealth,auto,node distance=1.6cm,
				every loop/.style={},thick,main node/.style={circle,draw,font=\footnotesize}]
			
			\node[main node] (000) {000};
			\node[main node] (010) [below of=000] {010};
			\node[main node] (101) [below of=010] {101};
			\node[main node] (111) [below of=101] {111};
			
			\node[main node] (001) [right of=010,yshift=.35cm] {001};
			\node[main node] (100) [left of=010,yshift=.35cm] {100};
			\node[main node] (011) [right of=101,yshift=-.35cm] {011};
			\node[main node] (110) [left of=101,yshift=-.35cm] {110};
			
			\draw[every node/.style={font=\scriptsize}]
			(000) edge [loop above] node {0000} (000)
						edge [bend left=20] node {0001} (001)
			(001) edge [bend left=20] node {0010} (010)
						edge [bend left=25] node {0011} (011)
			(010) edge [bend left=20] node {0100} (100)
						edge [bend left] node {0101} (101)
			(011) edge [bend left=15] node {0110} (110)
						edge [bend left=20] node {0111} (111)
			(100) edge [bend left=20] node {1000} (000)
						edge [bend left=15] node {1001} (001)
			(101) edge [bend left] node {1010} (010)
						edge [bend left=20] node {1011} (011)
			(110) edge [bend left=25] node {1100} (100)
						edge [bend left=20] node {1101} (101)
			(111) edge [bend left=20] node {1110} (110)
						edge [loop below] node {1111} (111);
			\end{tikzpicture}
		\end{tabular} \\
		$G_1$ & $G_2$ & $G_3$
	\end{tabular}
	\caption{Digrafos de De Bruijn de orden $1$, $2$ y $3$
		para $\alphabet = \lbrace 0, 1 \rbrace$.}
\end{figure}

Cada collar de $n$-de De Bruijn se corresponde unívocamente con un circuito
hamiltoniano en el digrafo $G_n$, es decir, un camino cerrado que visita cada
vértice exactamente una vez. El collar se conforma concatenando en orden
el primer carácter de cada uno de los vértices visitados por el circuito.

Una propiedad muy interesante de la familia de digrafos de De Bruijn es que
cada $G_n$ es el grafo de línea de $G_{n-1}$; es decir, $G_n$ puede
construirse tomando como vértices el conjunto de aristas de $G_{n-1}$ y
colocando una arista entre cada par de vértices si las aristas correspondientes
en $G_{n-1}$ son adyacentes. Esto quiere decir que los circuitos hamiltonianos
en $G_n$ se corresponden con circuitos eulerianos en $G_{n-1}$, esto es,
caminos cerrados que utilizan cada arista exactamente una vez.

De Bruijn utiliza esta naturaleza recursiva de la familia de digrafos $G_n$
para demostrar una fórmula cerrada para la cantidad de collares de De Bruijn
de orden $n$ existentes, que en el caso de un alfabeto binario es exactamente
$\frac{2^{2^{n-1}}}{2^n}$. Este resultado fue luego generalizado en
\cite{van-aardenne-ehrenfest-circuits-and-trees} para alfabetos de tamaño arbitrario,
donde la cantidad de collares es $\frac{(b!)^{b^{n-1}}}{b^n}$.

Cabe señalar que, debido a sus características, la forma más natural de
presentar la definición de los collares de De Bruijn es justamente en términos
de collares, o palabras circulares. No obstante --y esta situación se repite
para otras definiciones similares que aparecen más adelante en este trabajo--,
en ocasiones interesa tener en cuenta cada corte particular de un collar como
un elemento distinto. Por eso, en adelante, utilizaremos el término
\emph{secuencia de De Bruijn} para referirnos a un corte de un collar de De
Bruijn\footnote{Queremos hacer énfasis en este punto, ya que el término
\emph{secuencia de De Bruijn} es utilizado de forma ambigua en la literatura.
Para algunos autores, una secuencia de De Bruijn de orden $n$ es una secuencia
de longitud $b^n + n - 1$, donde cada palabra posible de longitud $n$ aparece
exactamente una vez, sin considerar apariciones circulares.}.

¿Cuántas secuencias $n$-de De Bruijn existen para cada $n$? Se puede notar que
el período de una secuencia $n$-de De Bruijn es necesariamente igual a su
longitud, $b^n$; de lo contrario, la palabra de longitud $n$ con la que comienza
volvería a aparecer más adelante. Luego, cada collar $n$-de De Bruijn tiene
$b^n$ cortes distintos, con lo cual la cantidad de secuencias $n$-de De Bruijn
es exactamente $(b!)^{b^{n-1}}$.

\subsection{El teorema \BEST{}}

El teorema \BEST{} es un resultado en teoría de grafos que permite determinar la
cantidad de circuitos eulerianos en un multidigrafo. Recibe su nombre por las
iniciales de sus descubridores, de Bruijn, van Aardenne-Ehrenfest, Smith y
Tutte.

\begin{theorem*}[\BEST{}, \pending{[cita]}]
	Sea $G$ un multidigrafo euleriano con vértices $v_1, \dots, v_n$.
	La cantidad de circuitos eulerianos en $G$ está dada por
	\[ \operatorname{ec}(G) = t_k \cdot \prod_{i=1}^n (d_i - 1)!, \]
	donde $d_i$ es el grado de salida de $v_i$ y $t_k$ es la cantidad de árboles
	generadores de $G$ orientados hacia un vértice $v_k$ arbitrario.
\end{theorem*}

Para obtener la cantidad de árboles generadores en un multidigrafo euleriano,
puede usarse a su vez el teorema de Kirchoff, que permite calcularla
a partir de su \emph{matriz laplaciana}, definida como
\[ \laplacian(G) = \left\lbrace \begin{array}{ll}
	d_i - d_{ii} & \text{si $i = j$} \\
	-d_{ij}       & \text{si $i \neq j$}
\end{array} \right\rbrace_{i,j = 1,\dots,n}, \]
donde $d_i$ es el grado de salida de $v_i$ y $d_{ij}$ es la cantidad de
aristas que van de $i$ a $j$.

\begin{theorem*}[Kirchoff, \pending{[cita]}]
	Sea $G$ un multidigrafo con vértices $v_1, \dots, v_n$. La cantidad
	de árboles generadores orientados hacia un vértice $v_i$ es el $i$-ésimo
	cofactor de la matriz $\laplacian(G)$, es decir,
	\[ t_i = \operatorname{det}(\laplacian_i(G)), \]
	siendo $\laplacian_i(G)$ la matriz que se obtiene al omitir la $i$-ésima fila
	y la $i$-ésima columna de $\laplacian(G)$.
\end{theorem*}

En multidigrafos eulerianos, el vértice que se elija resulta irrelevante, ya
que la cantidad de árboles generadores hacia cualquiera de ellos es invariante;
en otras palabras, todos los cofactores de $\laplacian(G)$ son iguales. En
el caso concreto del digrafo de De Bruijn de orden $n$, es posible demostrar
\pending{[cita]} que
\[ t_k = \frac{b^{b^{n}}}{b^{n+1}}, \]
lo cual, junto al hecho de que posee exactamente $b^n$ vértices y el grado de
salida de todos ellos es exactamente $b$, permite utilizar el teorema \BEST{} para
contabilizar la cantidad de circuitos eulerianos:
\begin{align*}
	\operatorname{ec}(G_n) &= t_k \cdot \prod_{i=1}^{b^n} (d_i - 1)! \\
		&= \frac{b^{b^{n}}}{b^{n+1}} \cdot \left((b - 1)!\right)^{b^n} \\
		&= \frac{(b!)^{b^{n}}}{b^{n+1}}.
\end{align*}

Notar que esta fórmula se corresponde exactamente con la dada en la sección
anterior para la cantidad de collares de De Bruijn de orden $n + 1$.

\subsection{Secuencias maravillosas}

A continuación presentaremos una generalización de las secuencias de De Bruijn,
que denominaremos \emph{secuencias maravillosas}.

\begin{definition}[Secuencia maravillosa]
Un \emph{collar $(n,m)$-maravilloso} es un collar de longitud $m \cdot b^n$
en el que cada una de las posibles palabras de longitud $n$ aparece
exactamente $m$ veces.

Una \emph{secuencia $(n,m)$-maravillosa} es un corte de un collar
$(n,m)$-maravilloso.
\end{definition}

\begin{examples}
	Las siguientes secuencias son $(2,4)$ y $(3,3)$-maravillosas, respectivamente:
	\[ 1110000111010010; \qquad 000111110110110100100100. \]

	Todas las secuencias $n$-de De Bruijn son ejemplos de secuencias
	$(n,1)$-maravillosas.
\end{examples}

Una pregunta inmediata que surge de esta definición es cómo puede extenderse a
los collares maravillosos la caracterización como circuitos eulerianos
presentada para los collares de De Bruijn, y si es posible utilizar este enfoque
para determinar la cantidad de secuencias maravillosas existentes para cada valor
de $n$ y $m$, lo cual resulta de especial interés más adelante en este
trabajo.

Un enfoque posible consiste en definir una familia de \emph{multidigrafos de De
	Bruijn}.
Llamamos multidigrafo de De Bruijn de orden $n$ y grado $m$ al multidigrafo
$G_n^m$ que se obtiene a partir del digrafo de De Bruijn de orden $n$ si se
replica $m$ veces cada arista.
Con esta definición, es inmediato comprobar que todo circuito euleriano en
$G_n^m$ (o hamiltoniano en $G_{n+1}^m$) determina de manera unívoca un collar
$(n+1, m)$-maravilloso.
Recordemos que cada arista de $G_n$ puede asociarse con una palabra distinta de
longitud $n+1$; como en $G_n^m$ existen $m$ copias de cada arista, una
secuencia obtenida a partir de un circuito euleriano contendrá cada una de
estas palabras exactamente $m$ veces.


\begin{figure}[h] \centering
	\begin{tikzpicture}[->,>=stealth,auto,node distance=2.2cm,
		every loop/.style={},thick,main node/.style={circle,draw,font=\small}]
	
	\node[main node] (00) {00};
	\node[main node] (01) [below right of=00] {01};
	\node[main node] (10) [below left of=00] {10};
	\node[main node] (11) [below right of=10] {11};
	
	\draw[every node/.style={font=\scriptsize}]
	(00) edge [in=30, out=60, loop] (00)
	     edge [loop above] node {000} (00)
	     edge [in=120, out=150, loop] (00)
	     edge [bend left=36] node {001} (01)
	     edge [bend left=23] (01)
	     edge [bend left=10] (01)
	(01) edge [bend left=36] node {011} (11)
	     edge [bend left=23] (11)
	     edge [bend left=10] (11)
	     edge [bend left=36] node {010} (10)
	     edge [bend left=23] (10)
	     edge [bend left=10] (10)
	(10) edge [bend left=36] node {100} (00)
	     edge [bend left=23] (00)
	     edge [bend left=10] (00)
	     edge [bend left=36] node {101} (01)
	     edge [bend left=23] (01)
	     edge [bend left=10] (01)
	(11) edge [bend left=36] node {110} (10)
	     edge [bend left=23] (10)
	     edge [bend left=10] (10)
	     edge [in=210, out=240, loop] (11)
	     edge [loop below] node {111} (11)
	     edge [in=300, out=330, loop] (11);
	\end{tikzpicture}
	\caption{Multidigrafo de De Bruijn de orden $2$ y grado $3$
		para $\alphabet = \lbrace 0, 1 \rbrace$.}
\end{figure}

No obstante, esto no vale a la inversa, ya que si $m > 1$, todo collar
$(n+1,m)$-maravilloso se corresponde con más de un ciclo euleriano en $G_n^m$.
Esto se debe a que las $m$ apariciones de una palabra de longitud $n + 1$ en un
collar son indistinguibles, por lo que las $m$ aristas respectivas pueden ser
permutadas, obteniendo un nuevo ciclo euleriano que se corresponde con el mismo
collar.
Concretamente, como existen $m! $ maneras de permutar cada conjunto de $m$
aristas, se tiene un total de $b^{n+1} \cdot m!$ maneras distintas de
representar un collar $(n+1,m)$-maravilloso con un circuito euleriano.

Si se tiene este hecho en consideración, es posible aplicar el teorema \BEST{}
para contabilizar la cantidad de circuitos eulerianos en los multidigrafos de
De Bruijn y así obtener una fórmula cerrada para la cantidad de collares
maravillosos.
Sin embargo, si lo que se desea contar son las secuencias maravillosas --en
lugar de los collares--, surge una nueva dificultad, ya que a diferencia de los
collares de De Bruijn, el período de un collar maravilloso no es invariante, es
decir, la cantidad de secuencias distintas que pueden obtenerse realizando
cortes a un collar maravilloso es diferente para cada collar.

Para salvar este obstáculo, decidimos buscar un enfoque alternativo que
permitiera caracterizar directamente las secuencias maravillosas, utilizando la
noción de \emph{circuito $\pi$-euleriano} presentada por Farrell y Levine en
\cite{farrell-multi-eulerian-tours}.

\begin{definition}[Circuito $\pi$-euleriano, \cite{farrell-multi-eulerian-tours}]
	Sea $G$ un digrafo con vértices $v_1, \dots, v_n$, y sea $\pi \in
		\mathbb{N}^n$
	un vector con valores estrictamente positivos.
	Un circuito $\pi$-euleriano en $G$ es un circuito donde cada arista
	($v_i$, $v_j$) se utiliza exactamente $\pi_j$ veces.
\end{definition}

Esta noción generaliza la de circuito euleriano, ya que estos son circuitos
$\pi$-eulerianos con $\pi = (1, \dots, 1)$.
Partiendo de aquí, los autores presentan la siguiente generalización del
teorema \BEST{}.

\begin{lemma*}[\BEST{} generalizado, \cite{farrell-multi-eulerian-tours}]
	\label{prop:BEST-generalized}
	Sea $G$ un multidigrafo fuertemente conexo con vértices $v_1, \dots, v_n$, y
	sea $\pi \in \mathbb{N}^n$.
	Existen circuitos $\pi$-eulerianos en $G$ si y solo si
	\[ \laplacian(G) \cdot \pi = 0, \]
	en cuyo caso la cantidad de estos circuitos que comienzan con una arista $e$
	determinada es
	\[ \operatorname{ec}_\pi(G, e) = t_e \cdot
		\prod_{i=1}^n \frac{(d_i\pi_i - 1)! }{(\pi_i!)^{d_i-1}(\pi_i-1)!}, \]
	donde $d_i$ es el grado de salida de $v_i$, y $t_e$ es la cantidad de árboles
	generadores de $G$ orientados hacia la cola de $e$.
\end{lemma*}

El interés de esta generalización para nuestro problema particular radica en que
una secuencia $(n+1,m)$-maravillosa puede identificarse de forma unívoca con un
circuito $\pi$-euleriano en $G_n$ tomando $\pi = (m,\dots,m)$ y fijando cuál
será su arista inicial.
Esto nos permite enunciar y demostrar el siguiente resultado.

\begin{theorem}
	\label{theorem:marvellous-count}
	Sean $n, m > 0$.
	La cantidad de secuencias $(n,m)$-maravillosas es exactamente
	\[ \left( \frac{(bm)! }{(m!)^b} \right)^{b^{n-1}}. \]
\end{theorem}

\begin{proof}
	Consideraremos primero el caso en que $n > 1$.
	En este caso, como se mencionó anteriormente, fijando $\pi = (m, \dots, m)$,
	basta con determinar la cantidad de circuitos $\pi$-eulerianos en $G_{n-1}$
	para cada una de las posibles elecciones de arista inicial.
	Sabemos que existen circuitos $\pi$-eulerianos en $G_{n-1}$, ya que se trata
	de un digrafo euleriano, por lo que basta con tomar un circuito euleriano y
	repetirlo $m$ veces para obtener un ejemplo.
	Es decir que, en virtud del teorema \BEST{} generalizado, la cantidad de
	secuencias maravillosas será igual a \[ \sum_e \epsilon_\pi(G_{n-1}, e) =
		\sum_e t_e \cdot \prod_{i=1}^{b^{n-1}} \frac{(d_i\pi_i - 1)!
		}{(\pi_i!)^{d_i-1}(\pi_i-1)!}, \] donde la suma se realiza sobre todas las
	aristas del digrafo $G_{n-1}$.

	Se sabe que la cantidad de aristas de $G_{n-1}$ es $b^n$; por otro lado, la
	cantidad de árboles generadores orientados hacia cualquiera de los vértices
	de $G_{n-1}$ es $\frac{b^{b^{n-1}}}{b^n}$ [¿cita?], de donde se sigue que
	$\sum_{e} t_e = b^{b^{n-1}}$.
	Reemplazando en la expresión anterior, se obtiene \[ b^{b^{n-1}} \cdot
		\prod_{i=1}^{b^{n-1}} \frac{(d_i\pi_i - 1)! }{(\pi_i!)^{d_i-1}(\pi_i-1)!}.
	\]

	Dado que $G_{n-1}$ es un digrafo regular cuyos vértices tienen todos grado de
	salida $b$, y dado que $\pi_i = m$ para todo $i = 1, \dots, b^{n-1}$, la
	expresión anterior equivale a
	\begin{align*}
		b^{b^{n-1}} \cdot \left( \frac{(bm - 1)! }{(m!)^{b-1}(m-1)!} \right)^{b^{n-1}}
			&= \left( \frac{b (bm - 1)! }{(m!)^{b-1}(m-1)!} \right)^{b^{n-1}} \\
			&= \left( \frac{bm (bm - 1)! }{(m!)^{b-1}m(m-1)!} \right)^{b^{n-1}} \\
			&= \left( \frac{(bm)! }{(m!)^b} \right)^{b^{n-1}}.
	\end{align*}

	Resta demostrar el caso en que $n = 1$. Para esto, basta observar que una
	secuencia $(1,m)$-maravillosa es una secuencia de longitud $bm$ en donde
	cada uno de los $b$ símbolos del alfabeto aparece exactamente $m$ veces.
	Por lo tanto, para construir una de estas secuencias, en primer lugar es
	necesario seleccionar cuáles $m$ de entre las $bm$ posiciones corresponderán
	al primer símbolo; luego, cuáles $m$ de entre las $(b - 1)m$ posiciones
	restantes corresponderán al segundo símbolo; en tercer lugar, cuáles $m$ de
	entre las $(b - 2)m$ posiciones restantes corresponderán al tercer símbolo,
	y así sucesivamente. Es decir, la cantidad de formas distintas de construir
	una secuencia $(1,m)$-maravillosa puede expresarse como el siguiente producto
	de números combinatorios:
	\begin{align*}
		\prod_{i = 0}^{b - 1} \binom{(b - i)m}{m}
			&= \prod_{i = 0}^{b - 1} \frac{((b-i)m)!}{m!((b-i-1)m)!} \\
			&= \frac{(bm)!}{m!((b-1)m)!} \cdot
				\frac{((b-1)m)!}{m!((b-2)m)!} \cdot
				\frac{((b-2)m)!}{m!((b-3)m)!} \cdot \dots \cdot
				\frac{m!}{m!0!} \\
			&= \frac{(bm)!}{(m!)^b},
		\end{align*}
	lo cual es consistente con la fórmula presentada.
\end{proof}

\subsection{Secuencias maravillosas anidadas}

Las secuencias maravillosas que acabamos de presentar son primas cercanas de
las \emph{secuencias perfectas}.
Una secuencia $(n,m)$-perfecta es una secuencia de longitud $m \cdot b^n$ en la
que cada posible palabra de longitud $n$ aparece circularmente exactamente
$m$ veces, al igual que en las secuencias maravillosas, pero con la restricción
adicional de que cada una de estas apariciones se produce en una posición
distinta módulo $m$.
Puede verse una presentación de estas secuencias en \cite{alvarez-perfect-necklaces},
junto a una caracterización de las mismas en términos de grafos.

En \cite{becher-nested-perfect}, Becher y Carton definen las \emph{secuencias
perfectas anidadas}; las mismas son secuencias maravillosas que, a su vez,
son la concatenación de secuencias maravillosas anidadas del orden inferior.
Los autores brindan un método basado en matrices que permite --bajo ciertas
restricciones-- generar estas secuencias.

Esto motiva una definición análoga, pero considerando secuencias maravillosas en
lugar de perfectas: las \emph{secuencias maravillosas anidadas}, el principal
objeto de estudio de este trabajo.

\begin{definition}
	Una \emph{secuencia $(n,m)$-maravillosa anidada} es una secuencia de
	longitud $m \cdot b^n$ para la que se cumple simultáneamente que
	\begin{enumerate}
		\item es una secuencia $(n,m)$-maravillosa; y
		\item si $n > 1$, es la concatenación de $b$ secuencias
		      $(n-1,m)$-maravillosas anidadas.
	\end{enumerate}

	Alternativamente, una secuencia es $(n,m)$-maravillosa anidada si, para todo
	$n'$ tal que $1 \leq n' \leq n$, toda subsecuencia de longitud
	$m \cdot b^{n'}$ que comienza en una posición congruente a $0$ módulo
	$m \cdot b^{n'}$ es $(n',m)$-maravillosa.
\end{definition}

\pending{Hablar de átomos.}

\pending{Explicar problema a resolver (ver cómo se lleva con la introducción).}

\newpage

\section{Una familia maravillosa: las secuencias maravillosas autosimilares}

En esta sección presentamos un método de construcción que permite generar
secuencias $(n,m)$-maravillosas anidadas que no son perfectas anidadas, siempre
y cuando se cumpla que $m = b^{n - 1}$.
Este método fue motivado por el estudio de una subfamilia de las secuencias
maravillosas anidadas, que denominamos \emph{secuencias autosimilares}.

\begin{definition}
	Una secuencia $x$ es $(n,m)$-\emph{autosimilar} si consiste en $b^{n-1}$
	repeticiones de una misma secuencia de longitud $bm$.
\end{definition}

\begin{example}
	La secuencia \[ 01110110\ 01110110\ 01110110\ 01110110 \] es
	$(3,4)$-autosimilar.
	La secuencia \[ 110000101011 \ 110000101011 \] es $(2,6)$-autosimilar; además,
	es $(2,6)$-maravillosa anidada.
\end{example}

\begin{proposition} \label{proposition:autosimilar-cannot-be-np}
	Una secuencia $(n,m)$-autosimilar con $n > 1$ no puede ser $(n,m)$-perfecta.
\end{proposition}

\begin{proof}
	Dado que la secuencia se construye repitiendo al menos dos veces una misma
	secuencia de longitud $bm$, la palabra de longitud $n$ que aparece en la
	posición $0$ de la secuencia aparece nuevamente en la posición $bm$.
	Esto contradice la definición de secuencia perfecta, ya que cada aparición de
	dicha palabra debería comenzar en una posición distinta módulo $m$.
\end{proof}

Nos interesa estudiar las secuencias $(n,m)$-maravillosas anidadas que, además,
son autosimilares.
Cabe señalar que las mismas están conformadas por un único $m$-átomo repetido
$b^{n-1}$ veces.
La proposición que enunciaremos a continuación nos permite caracterizarlas a
partir de una propiedad verificable los átomos que les dan origen.
Este resultado nos permitirá determinar para qué valores de $(n,m)$ existen
este tipo de secuencias, cuál es su cantidad, y presentar un método para su
construcción.

\begin{theorem}
	\label{theorem:autosimilar-nm-characterization}
	Sea $x = \omega^{b^{n-1}}$ una secuencia $(n,m)$-autosimilar.
	$x$ es $(n,m)$-maravillosa anidada si y solo si $b^{n-1} \vert m$ y
	$\omega$
	es una secuencia $\left( n, \frac{m}{b^{n-1}} \right)$-maravillosa.
\end{theorem}

\begin{examples}\ %
	\begin{itemize}
		\item El $4$-átomo $01011100$ es $(1,4)$, $(2,2)$ y
		      $(3,1)$-maravilloso.
		      Por lo tanto, las siguientes tres secuencias son $(1,4)$, $(2,4)$ y
		      $(3,4)$-maravillosas anidadas, respectivamente.
		      \[ 01011100; \qquad 01011100\ 01011100; \qquad 01011100\
			      01011100\ 01011100\ 01011100.
		      \]
		\item El $4$-átomo $10001101$ es $(1,4)$ y $(2,2)$-maravilloso,
		      pero no $(3,1)$-maravilloso.
		      Por lo tanto, las siguientes dos secuencias son $(3,1)$ y $(3,2)$-maravillosas
		      anidadas, respectivamente.
		      \[ 10001101; \qquad 10001101\ 10001101,
		      \]
		      pero la secuencia
		      \[ 10001101\ 10001101\ 10001101\
			      10001101 \]
		      no es $(3,4)$-maravillosa anidada.
	\end{itemize}
\end{examples}

El siguiente lema se presenta a modo de resultado intermedio para
demostrar el Teorema \ref{theorem:autosimilar-nm-characterization}.

\begin{lemma} \label{lemma:marvellous-for-smaller-n}
	Sea $x$ una secuencia $(n,m)$-mavarillosa.
	Para todo $k$ tal que $0 \leq k < n$, la secuencia $x$ es
	$(n - k, b^{k}m)$-maravillosa.
\end{lemma}

\begin{example}
	La secuencia $(3,4)$-maravillosa \[ 00001111\ 00101011\ 00101101\ 11100010, \]
	es también $(2,8)$ y $(1,16)$-maravillosa.
\end{example}

\begin{proof}
	Consideremos una palabra $w$ cualquiera de longitud $n - k$.
	Para extender $w$ a una palabra de longitud $n$ debe agregársele un sufijo de
	longitud $k$, por lo que existen $b^{k}$ formas distintas de hacerlo.
	Todas estas palabras que resultan de extender $w$ aparecen exactamente $m$
	veces en $x$, ya que esta es una secuencia $(n,m)$-mavarillosa.
	Luego, $w$ aparece exactamente $b^{k}m$ veces en $x$, $m$ veces como prefijo de
	una palabra de longitud $n$ distinto.
	Por lo tanto, $x$ es una secuencia $(n - k, b^{k}m)$-maravillosa.
\end{proof}

Habiendo probado este resultado, estamos en condiciones de presentar una
demostración para el Teorema \ref{theorem:autosimilar-nm-characterization}.

\begin{proof}[Demostración del Teorema \ref{theorem:autosimilar-nm-characterization}]
	Si partimos del supuesto de que $b^{n-1}$ no divide a $m$, o bien que
	$\omega$ no es una secuencia $\left( n, \frac{m}{b^{n-1}}
		\right)$-maravillosa,
	podemos concluir que existe una palabra $w$ de longitud $n$ que aparece
	circularmente en $\omega$ una cantidad de veces diferente de
	$\frac{m}{b^{n-1}}$.
	Por lo tanto, la cantidad de veces que $w$ aparece circularmente
	en $x = \omega^{b^{n-1}}$ es diferente de $m$.
	Es decir, en este caso, $x$ no puede ser una secuencia $(n,m)$-maravillosa
	anidada.

	Para demostrar la implicación opuesta, supongamos que $b^{n-1} \vert m$
	y $\omega$ es una secuencia $\left(n, \frac{m}{b^{n-1}} \right)$-maravillosa.
	Demostraremos que para todo $n'$ tal que $1 \leq n' \leq n$, la secuencia
	$\omega^{b^{n'-1}}$ es $(n',m)$-maravillosa anidada.
	En el caso particular $n' = n$, esto equivale a decir que $x$ es una secuencia
	$(n,m)$-maravillosa anidada.

	En el caso $n' = 1$, el resultado se sigue del Lema
	\ref{lemma:marvellous-for-smaller-n} que, tomando $k = n-1$, nos permite
	afirmar que $\omega$ es una secuencia $(1,m)$-maravillosa.

	Si $n'$ es tal que $1 < n' \leq n$, supongamos probado el resultado para
	$n'-1$.
	Esto quiere decir que, siendo $y = \omega^{b^{n' - 2}}$, $y$ es una secuencia
	$(n'-1, m)$-maravillosa anidada.
	Para probar que $\omega^{b^{n' - 1}} = yy$ es $(n',m)$-maravillosa anidada,
	solo resta ver que es $(n',m)$-maravillosa, ya que es la concatenación de dos
	secuencias $(n'-1, m)$-maravillosas anidadas.

	Empleando otra vez el Lema \ref{lemma:marvellous-for-smaller-n}, esta vez para
	$k = n - n'$, tenemos que $\omega$ es una secuencia $\left( n', \frac{m}{b^{n'
				- 1}} \right)$-maravillosa.
	Esto significa que la cantidad de apariciones de cada palabra de longitud $n'$
	en $\omega$, mirada circularmente, es $\frac{m}{b^{n' - 1}}$; y por
	consiguiente, es $m$ en $\omega^{b^{n'-1}}$, por lo que esta última secuencia
	es $(n',m)$-maravillosa anidada.
\end{proof}

Dado que conocemos la cantidad de secuencias maravillosas que existen para
cualesquiera valores de $n$ y $m$, podemos enunciar el siguiente corolario.

\begin{corollary} \label{corollary:autosimilar-nm-count}
	Sean $n, m > 0$.
	Si $b^{n-1} \vert m$, sea $k = \frac{m}{b^{n-1}}$; existen
	$\left( \frac{(bk)! }{(k!)^b} \right)^{b^{n-1}}$
	secuencias $(n,m)$-maravillosas anidadas que son autosimilares.
	De lo contrario, no existe ninguna tal secuencia.
\end{corollary}

\begin{proof}
	Se sigue de forma inmediata de la caracterización dada por el Teorema
	\ref{theorem:autosimilar-nm-characterization} y la fórmula para la cantidad de
	secuencias maravillosas presentada en el Teorema \ref{theorem:marvellous-count}.
\end{proof}

La siguientes tabla muestra las cantidades de secuencias maravillosas anidadas
autosimilares para los primeros valores de $n$ y $m$, considerando alfabetos
de $2$ y de $3$ símbolos.

\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|}
		\hline
		\diagbox[width=3em]{$n$}{$m$}	& 1 & 2 & 3  & 4  & 5   & 6   & 7    & 8     & 9     \\
		\hline
		1 & 2 & 6 & 20 & 70 & 252 & 924 & 3.432 & 12.870 & 48.620
		\\ \hline
		2 & 0 & 4 & 0  & 36 & 0   & 400 & 0     & 4.900  & 0     \\
		\hline
		3 & 0 & 0 & 0  & 16 & 0   & 0   & 0     & 1.296  & 0     \\
		\hline
		4 & 0 & 0 & 0  & 0  & 0   & 0   & 0     & 256    & 0     \\
		\hline
		5 & 0 & 0 & 0  & 0  & 0   & 0   & 0     & 0      & 0     \\
		\hline
	\end{tabular}
	\caption{Cantidad de secuencias $(n,m)$-maravillosas anidadas autosimilares
		considerando un alfabeto de $2$ símbolos.}
\end{table}

\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|}
		\hline
		\diagbox[width=3em]{$n$}{$m$} & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 \\ \hline
		1 & 6 & 90 & 1.680 & 34.650 & 756.756 & 17.153.136 & 399.072.960 & $9.5 \times 10^{9}$ & $2.3 \times 10^{11}$ \\ \hline
		2 & 0 & 0  & 216   & 0      & 0       & 729.000    & 0           & 0             & $4.7 \times 10^{9}$ \\ \hline
		3 & 0 & 0  & 0     & 0      & 0       & 0          & 0           & 0             & 10.077.696    \\ \hline
		4 & 0 & 0  & 0     & 0      & 0       & 0          & 0           & 0             & 0 \\
		\hline
	\end{tabular}
	\caption{Cantidad de secuencias $(n,m)$-maravillosas anidadas autosimilares
		considerando un alfabeto de $3$ símbolos.}
\end{table}

Puede notarse que, debido a la condición de que $b^{n-1} \vert m$ necesaria
para la existencia de este tipo de secuencias, el menor $m$ para el cual la
cantidad de secuencias no es $0$, dado un $n$ fijo, es $m = b^{n-1}$. Este caso
es especialmente interesante ya que los átomos que se utilizarán son secuencias
$(n, 1)$-maravillosas, es decir, secuencias $n$-de De Bruijn, para cuya
generación se han estudiado ya diversos métodos.

\newpage

\section{Ejemplos y conjeturas}

¿Cuáles son los valores de $n$ y $m$ para los cuáles existen secuencias
maravillosas anidadas? ¿Cuál es la cantidad de tales secuencias, en los casos
en que sí existen? ¿Cuántas de ellas, además, no son perfectas anidadas?
En esta sección presentamos las respuestas a las que pudimos arribar en el curso
de este trabajo, como así también algunas conjeturas acerca de los casos para
los que no contamos con certezas. En adelante, consideraremos siempre que
$\alphabet = \lbrace 0, 1 \rbrace$. El Cuadro
\ref{table:nested-marvellous-existence} presenta un resumen visual de los
resultados.

\begin{table}[h]
	\centering
	\small
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
		\hline
		\diagbox[width=3em]{$n$}{$m$} & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16  \\
		\hline
		1 & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A/R & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A/R & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A/R & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A & \cellcolor{e-count-for} A/R \\
		\hline
		2 & \cellcolor{e-count-emp} & \cellcolor{e-count-emp} A/R & \cellcolor{e-count-emp} & \cellcolor{e-count-emp} A/R & \cellcolor{e-count-emp} & \cellcolor{e-count-emp} A & \cellcolor{e-count-emp} & \cellcolor{e-count-emp} A/R & & A & & A & & A & & A \\
		\hline
		3 & \cellcolor{ne-proof} & \cellcolor{e-count-emp} & \cellcolor{e-count-emp} & \cellcolor{e-count-emp} A/R & \cellcolor{e-count-emp} & \cellcolor{e-examples} & \cellcolor{e-examples} & \cellcolor{e-examples} A/R & & & & A & & & & A \\
		\hline
		4 & \cellcolor{ne-proof} & \cellcolor{ne-empir} & \cellcolor{e-count-emp} & \cellcolor{e-examples} R & \cellcolor{e-examples} & \cellcolor{e-examples} & \cellcolor{e-examples} & \cellcolor{e-examples} A/R & & & & & & & & A \\
		\hline
		5 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-empir} & \cellcolor{e-examples} & & & & \cellcolor{e-examples} R & & & & & & & & A \\
		\hline
		6 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-empir} & \cellcolor{ne-conjc} & & & & \cellcolor{e-examples} R & & & & & & & & \\
		\hline
		7 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & \cellcolor{e-examples} R & & & & & & & & \\
		\hline
		8 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & \cellcolor{e-examples} R & & & & & & & & \\
		\hline
		9 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & & & & & & & \\
		\hline
		10 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & & & & & & \\
		\hline
		11 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & & & & & \\
		\hline
		12 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & & & & \\
		\hline
		13 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & & & \\
		\hline
		14 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & & \\
		\hline
		15 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & & \\
		\hline
		16 & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-proof} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & \cellcolor{ne-conjc} & & \\
		\hline
	\end{tabular} \vspace{1em} \\
	
	{
		\setlength{\fboxsep}{.3em}
		\fbox{
			\footnotesize
			\begin{tabular}{cl cl}
			\multicolumn{4}{c}{\textbf{\normalsize Referencia}} \vspace{.4em} \\
			\multicolumn{2}{c}{\textit{Valores para los que existen secuencias}}
				& \multicolumn{2}{c}{\textit{Valores para los que no existen secuencias}} \vspace{.25em} \\
			\color{e-count-for}{$\blacksquare$} & Cantidad expresada como fórmula cerrada
				& \color{ne-proof}{$\blacksquare$} & No existencia demostrada \\
			\color{e-count-emp}{$\blacksquare$} & Cantidad determinada experimentalmente
				& \color{ne-empir}{$\blacksquare$} & No existencia determinada experimentalmente \\
			\color{e-examples}{$\blacksquare$}  & Ejemplos hallados \\
			R & Ejemplos hallados rotando secuencias perfectas \\
			A & Método de secuencias autosimilares \\
			\multicolumn{4}{c}{\textit{Conjeturas}} \\
			$\square$  & Se conjetura que existen secuencias
				& \color{ne-conjc}{$\blacksquare$}  & Se conjetura que no existen secuencias \\
			\end{tabular}
		}
	}

	\caption{Existencia de secuencias $(n,m)$-maravillosas anidadas para los
	primeros valores de $n$ y $m$.}
	\label{table:nested-marvellous-existence}
\end{table}

Para determinados valores de $n$ y $m$, es posible extraer algunas conclusiones
a partir de lo ya presentado hasta ahora. En particular:

\begin{itemize}
	\item En el caso $n = 1$, las secuencias $(1,m)$-maravillosas anidadas se
	corresponden exactamente con las secuencias $(1,m)$-maravillosas. 
	Gracias al Teorema \ref{theorem:marvellous-count}, sabemos que estas
	existen y que su cantidad es exactamente $\frac{(2m)!}{(m!)^2}$. De las
	mismas, solo $2^m$ son perfectas anidadas, según la fórmula dada en
	\cite{becher-nested-perfect}.
	\item En los casos en que $m$ es un múltiplo de $2^{n-1}$, el método de
	construcción por secuencias autosimilares nos permite afirmar que existen
	secuencias $(n,m)$-maravillosas anidadas que no son $(n,m)$-perfectas
	anidadas. Lo expuesto hasta el momento no es suficiente para
	determinar si existen secuencias $(n,m)$-maravillosas anidadas que no sean
	perfectas anidadas ni se puedan generar a través de este método.
	Cabe notar que este caso corresponde a valores de $n$ relativamente pequeños
	con respecto a $m$ ya que, en el mejor de los casos, $m = 2^{n-1}$, con 
	lo que la relación entre ambos parámetros es a lo sumo de orden logarítmico.
\end{itemize}

Para poder abordar el análisis de los restantes valores posibles de $n$ y $m$
realizamos una exploración computacional, intentando generar exhaustivamente
todas las secuencias $(n,m)$-maravillosas anidadas.
La técnica que utilizamos es del tipo \emph{generate and test} y consiste en:
\begin{enumerate}[label=\arabic*.]
	\item Fijar un valor para el parámetro $m$.
	\item Generar todas las secuencias $(1,m)$-maravillosas ($m$-átomos) de manera
	combinatoria.
	\item Iterar sobre los valores de $n = 2, 3, \dots$, considerando como espacio
	de búsqueda todas las posibles concatenaciones de dos secuencias
	$(n-1, m)$-maravillosas anidadas (generadas en la iteración anterior) y
	eliminando aquellas que no sean $(n,m)$-maravillosas.
\end{enumerate}
Si bien este enfoque iterativo permite acotar el espacio de búsqueda, el mismo
crece rápidamente a medida que aumentan los valores de $n$ y $m$, por lo que
solo fue posible obtener resultados en los casos más pequeños.
En el Cuadro \ref{table:nested-marvellous-count} presentamos estos resultados.

\begin{table}[H]
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
		\hline
		\diagbox[width=3em]{$n$}{$m$}
		  & 1 & 2  & 3     & 4       & 5          & 6       & 7         & 8          \\
		\hline
		1 & 2 & 6  & 20    & 70      & 252        & 924     & 3.432     & 12.870     \\ \hline
		2 & 2 & 16 & 156   & 1.720   & 20.420     & 254.744 & 3.292.632 & 43.705.512 \\
		\hline
		3 & 0 & 16 & 1.344 & 237.504 & 26.647.952 & -       & -         & -          \\
		\hline
		4 & 0 & 0  & 1.568 & -       & -          & -       & -         & -          \\
		\hline
		5 & 0 & 0  & 0     & -       & -          & -       & -         & -          \\
		\hline
	\end{tabular}
	\caption{Cantidad total de secuencias $(n,m)$-maravillosas anidadas binarias
		para los valores para los fue posible generarlas de forma exhaustiva.}
	\label{table:nested-marvellous-count}
\end{table}

\subsection{Valores para los que no existen secuencias}

Un primer hecho que puede constatarse al observar las columnas correspondientes
a $m = 1, 2, 3$ es la inexistencia de secuencias cuando el valor de $n$ crece
más allá de $m + 1$. Naturalmente, surge la pregunta de si esto se puede
generalizar para valores de $m$ más grandes.
Un análisis de la situación permite concluir que existe una
incompatibilidad entre los distintos niveles de anidación de las secuencias.
A medida que $n$ crece con respecto a $m$, se fuerza la aparición de largas
cadenas de ceros y de unos dentro de la misma. Sin embargo, la secuencia debe
a su vez consistir en la concatenación de muchas pequeñas secuencias
$(1,m)$-maravillosas, donde la cantidad de ceros y unos debe estar equilibrada.
El resultado que presentamos a continuación formaliza este razonamiento.

\begin{proposition}
	No existen secuencias $(n,m)$-maravillosas anidadas para ningunos $n$, $m$
	tales que $n > 2m$.
\end{proposition}

\begin{proof}
	Consideremos un valor fijo para $m$.
	En primer lugar, debemos notar que basta probar el resultado para $n = 2m +
		1$, ya que cualquier secuencia $(n',m)$-maravillosa anidada con $n'$ mayor
		que este $n$ puede factorizarse como una concatenación de secuencias
	$(n,m)$-maravillosas anidadas.

		Razonando por el absurdo, sea $n = 2m + 1$ y supongamos que existe una
	secuencia $x$ que es $(n,m)$-maravillosa anidada.
	Por definición, el patrón $0^{2m+1}$ debe aparecer $m$ veces circularmente
	en $x$. Sea $i$ la posición inicial en $x$ de la primera aparición de dicho
	patrón módulo $2m$.

	Recordemos que $x$ consiste en una concatenación de $m$-átomos, cada uno de
	los cuales tiene longitud $2m$. Los $2m+1$ ceros del patrón mencionado
	necesariamente abarcarán más de un átomo, con los primeros $2m - i + 1$ ceros
	ubicados dentro de un átomo y los $i$ ceros restantes en el átomo
	siguiente.

	\[ \underbrace{\alpha\dots\alpha}_{2m}
		\; \underbrace{\alpha\dots\alpha}_{2m} \; \cdots
		\; \underbrace{\alpha\dots\alpha\overbrace{00\dots00}^{2m-i+1}}_{2m}
		\; \underbrace{\overbrace{00\dots00}^{i}\dots\alpha}_{2m} \; \cdots
		\; \underbrace{\alpha\dots\alpha}_{2m} \]

	Notar que si $i \leq m$, entonces $2m - i + 1 > m$, por lo que hay
	más de $m$ ceros en el primer átomo; si, por el contrario, $i > m$, entonces
	hay más de $m$ ceros en el segundo átomo. Ninguno
	de los dos casos es posible, ya que la cantidad de ceros en un $m$-átomo es
	exactamente $m$.
\end{proof}

Para los casos restantes, aventuramos las siguientes conjeturas, para las que
no contamos con demostración:
\begin{itemize}
	\item \textbf{Conjetura 1}. Para todo $(n,m)$ con $n > m + 1$ no existen
		secuencias $(n,m)$-maravillosas anidadas.
	\item \textbf{Conjetura 2}. Para todo $(n,m)$ con $n \leq m + 1$ existen
	secuencias $(n,m)$-maravillosas anidadas. Además, la cantidad de estas
	secuencias es considerablemente mayor que la cantidad de secuencias
	$(n,m)$-perfectas anidadas.
\end{itemize}

La primera conjetura es motivada, en primer lugar, porque se cumple para todos
los valores de $m$ que pudieron ser estudiados exhaustivamente en forma
computacional. Además, en estos casos se ve que fijando $m$ e incrementando
$n$, la cantidad de secuencias halladas aumenta de forma sostenida hasta que
$n = m$; en el caso $n = m + 1$ el incremento en la cantidad es nulo o menor.
Esto sugiere que las incompatibilidades entre los niveles extremos de anidación
de las secuencias comienzan a manifestarse antes de llegar a $n = 2m$.
No obstante, es claro que esta conclusión podría estar sesgada debido a que
los valores de $m$ que fue posible estudiar son muy pequeños.

\subsection{Valores para los que existen secuencias}

En respaldo de nuestra segunda conjetura, podemos exhibir una serie de ejemplos
que constatan la existencia de secuencias $(n,m)$-maravillosas anidadas para
algunos de los valores de los parámetros. Los mismos fueron obtenidos a partir
de dos métodos distintos.

\begin{itemize}
	\item \textbf{Rotaciones de secuencias perfectas anidadas}. Es posible obtener ejemplos
	de secuencias $(n,m)$-maravillosas anidadas que no son perfectas anidadas
	partiendo de una secuencia $(n,m)$-perfecta anidada y rotando una de sus
	mitades. Esta operación preserva la propiedad de que ambas mitades de la
	secuencia sean $(n-1,m)$-maravillosas anidadas, y en muchos casos se logra
	preservar la cantidad de apariciones de todos los patrones de longitud $n$,
	dejando de cumplirse que todas sean en distintas posiciones módulo $m$.

	Mediante este método pudimos generar ejemplos para $m = 2, 4, 8$ y
	$n = 1, \dots, m$ (recordemos que el método para generar secuencias perfectas
	anidadas presentado en \cite{becher-nested-perfect} solo está definido para valores
	de $m$ que sean potencias de $2$). Consideramos que este método tiene buenas
	perspectivas de funcionar también para $m = 16, 32$, etc.

	\note{¿Dar ejemplos concretos? ¿Para qué valores?}

	\item \textbf{\emph{Generate and test} submuestreando el espacio de búsqueda}.
	Consiste en adaptar el método de generación exhaustivo antes descripto, de
	manera que en cada iteración solo se utilicen algunas de las secuencias
	obtenidas para determinado valor de $n$ en la generación de posibles
	secuencias de orden $n + 1$, descartando el resto. De esta forma ya no es
	posible determinar \emph{cuántas} secuencias existen, pero sí obtener una
	buena cantidad de ejemplos, muchos de los cuales no son secuencias perfectas
	anidadas.

	Con este método se consiguieron ejemplos para:
	\begin{itemize}
		\item $m = 4$; $n = 4, 5$.
		\item $m = 5$; $n = 4, 5$.
		\item $m = 6$; $n = 3, 4, 5$.
		\item $m = 7$; $n = 3, 4, 5$.
	\end{itemize}

	\note{¿Dar ejemplos concretos? ¿Para qué valores?}
\end{itemize}

Estos ejemplos dan cuenta de la existencia de secuencias maravillosas anidadas
que no son perfectas; pero no responden al interrogante de cuántas
existen, y cómo se comparan las cantidades de unas y otras.
No obstante, el segundo de los dos métodos presentados permite realizar una
estimación que arroja algo de luz sobre esta pregunta. La observación central
es que, si el espacio de búsqueda es submuestrado de forma aleatoria,
la proporción de secuencias maravillosas anidadas halladas es similar
a la existente en el espacio de búsqueda completo.

A modo de ejemplo, sabemos que la cantidad de secuencias $(1,8)$-maravillosas
anidadas es 12.870. El conjunto de pares de estas secuencias, que es el espacio
de búsqueda completo para secuencias $(2,8)$-maravillosas anidadas, tiene
(12.870)$^2$ = 165.636.900 secuencias. De ellas solo 43.705.512, un $26.39\%$,
son $(2,8)$-maravillosas anidadas. Ahora bien, restringiendo la cantidad de
pares examinados a, por ejemplo, solo un millón seleccionados al azar, puede
obtenerse una estimación muy razonable de esta proporción. Realizando diez
corridas independientes, encontramos una media de 263.734 secuencias,
un $26.37\%$ de las secuencias inspeccionadas.

\note{Acá se puede hablar de cuál sería el error en la estimación y cosas así,
	pero me pareció que no venía al caso.}

Gracias a este enfoque podemos hacernos una idea aproximada de la cantidad
de secuencias maravillosas anidadas en casos en que la generación exhaustiva
se vuelve computacionalmente prohibitiva. Continuando con el caso $m = 8$,
en el Cuadro \ref{table:estimation} se exhibe la cantidad de secuencias halladas para distintos
valores de $n$ limitando el espacio de búsqueda de cada iteración a un máximo
de 1.000.000.000 de secuencias. \note{Este umbral se puede subir y buscar
resultados más precisos, solo va a tardar un poco más.}

\begin{table}[H]
	\centering
	\small
	\begin{tabular}{|p{32mm}|c|c|c|c|c|c|}
		\hline
		$n$ & 1 & 2 & 3 & 4 & 5 & 6 \\
		\hline
		Tamaño estimado del espacio de búsqueda & - & 165.636.900 & $1.91 \times 10^{15}$ & $7.79 \times 10^{27}$ & $1.78 \times 10^{50}$ & $1.35 \times 10^{89}$ \\
		\hline
		Pares examinados & - & 165.636.900 & 1.000.000.000 & 1.000.000.000 & 1.000.000.000 & 4.293.184 \\
		\hline
		Secuencias maravillosas anidadas halladas & 12.870 & 43.705.512 & 46.201.550 & 1.710.968 & 2.072 & 0 \\
		\hline
		Proporción & - & $26.39\%$ & $4.620\%$ & $0.1711\%$ & $0.00000207\%$ & $0\%$ \\
		\hline
		Cant. estimada de sec. marav. anidadas & 12.870 & 43.705.512 & $8.83 \times 10^{13}$ & $1.33 \times 10^{25}$ & $3.68 \times 10^{44}$ & - \\
		\hline
		Cant. de secuencias perfectas anidadas & 256 & 512 & 1.024 & 2.048 & 4.096 & 8.192 \\
		\hline
	\end{tabular}
	\caption{Resultados de estimar la cantidad de secuencias maravillosas anidadas
	para $m = 8$ submuestreando el espacio de búsqueda.}
	\label{table:estimation}
\end{table}

Para cada valor de $n$, se asume que el tamaño del espacio de búsqueda completo
sería el cuadrado de la cantidad de secuencias estimada para $n - 1$; este
valor aparece en la fila ``Tamaño estimado del espacio de búsqueda''. Luego,
se extrapola a este espacio completo la proporción de secuencias maravillosas
anidadas hallada en el subconjunto que se tomó al submuestrear, obteniendo
los valores de la fila ``Cantidad estimada de secuencias maravillosas
anidadas''.

Es necesario destacar que estos resultados, de carácter meramente exploratorio,
podrían presentar sesgos que es imposible eliminar sin un estudio más profundo.
La limitación más importante es que en cada iteración el espacio de búsqueda
utilizado está limitado a los pares de secuencias generadas en el paso anterior,
con lo cual, a medida que se incrementa $n$, la forma en que se submuestrea el
espacio es cada vez menos uniforme. Aún así, el hecho de que para encontrar
secuencias maravillosas anidadas sea suficiente con examinar una porción ínfima
del espacio de búsqueda completo sugiere fuertemente que las mismas son muy
abundantes.

En particular, todo indica que para valores relativamente pequeños de
$n$ con respecto a $m$, la cantidad de secuencias maravillosas anidadas es
muy superior a la cantidad de secuencias perfectas anidadas. El gráfico
de la Figura \ref{figure:compare-marvellous-perfect} permite comparar
visualmente estas cantidades.

\begin{figure}[H]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			x tick label style={
				/pgf/number format/1000 sep=},
			enlargelimits=0.05,
			legend style={at={(1.1,1)},
				anchor=north west},
			legend cell align={left},
			ybar,
			enlarge x limits={0.15},
			ymode=log,
		]
		\addplot 
			coordinates {(1,12870) (2,43705512) (3,8.83e13)
			(4,1.33e25) (5,3.68e44)};
		\addplot 
			coordinates {(1,256) (2,512) (3,1024)
			(4,2048) (5,4096)};
		\legend{Maravillosas anidadas (est.),Perfectas anidadas}
		\end{axis}
	\end{tikzpicture}
	\caption{Comparación entre la cantidad estimada de secuencias maravillosas
	anidadas y la cantidad de secuencias perfectas anidadas, para $m = 8$
	(escala logarítmica).}
	\label{figure:compare-marvellous-perfect}
\end{figure}

\bibliography{references}{}
\bibliographystyle{plain}

\end{document}
